apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: nextcloud
  namespace: argocd
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  destination:
    namespace: default
    server: https://kubernetes.default.svc
  project: default
  source:
    repoURL: https://nextcloud.github.io/helm
    targetRevision: 4.5.2
    chart: nextcloud
    helm:
      values: |
        ingress:
          enabled: true
          className: nginx
        nextcloud:
          host: nextcloud.localhost
          configs:
            s3.config.php: |-
              <?php
              $CONFIG = array (
                'objectstore' => [
                        'class' => '\\OC\\Files\\ObjectStore\\S3',
                        'arguments' => [
                                'bucket' => 'callepuzzle-nextcloud-temp',
                                'hostname' => 's3.us-west-004.backblazeb2.com',
                                'key' => '004bfa80387f28d0000000009',
                                'secret' => 'K004vdJzBAtaH+7tOa4KGHMcufK52pY',
                                // required for some non-Amazon S3 implementations
                                'use_path_style' => true,
                        ],
                ],
              );
          securityContext:
            runAsUser: 33
            runAsGroup: 33
            runAsNonRoot: true
            readOnlyRootFilesystem: false

          podSecurityContext:
            runAsUser: 33
            runAsGroup: 33
            runAsNonRoot: true
            readOnlyRootFilesystem: false
        livenessProbe:
          enabled: true
          initialDelaySeconds: 10
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
          successThreshold: 1
        readinessProbe:
          enabled: true
          initialDelaySeconds: 10
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
          successThreshold: 1
        startupProbe:
          enabled: true
          initialDelaySeconds: 120
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 30
          successThreshold: 1
        internalDatabase:
          enabled: false
        externalDatabase:
          enabled: true
          type: mysql
          host: mariadb
          user: user
          password: user
          database: data-test